# TuxBox Configuration
#
# This file configures your TourBox device button mappings.
#
# Configuration locations:
#   - Device settings: ~/.config/tuxbox/config.conf
#   - Profiles: ~/.config/tuxbox/profiles/*.profile
#
# Note: This legacy format (single file) is automatically migrated to the new
# format (individual profile files) when you run the GUI for the first time.
#
# After editing, restart the tuxbox driver for changes to take effect.

# =============================================================================
# DEVICE SECTION
# =============================================================================
# Configure your TourBox device connection (optional)
#
# USB:
#   usb_port: Serial port for USB connection (optional)
#             Default: /dev/ttyACM0
#             Only needed if using non-default port
#
# BLUETOOTH (BLE):
#   The driver automatically scans for TourBox devices by name.
#   No configuration needed!
#
# KEY COMBO TIMING:
#   modifier_delay: Milliseconds to wait between modifier keys (Ctrl/Shift/Alt/Meta)
#                   and other keys when sending key combinations. Default: 0 (disabled)
#                   Set to 20-50 if apps like GIMP don't recognize key combos.
#                   This adds a small delay so apps register the modifier first.
#                   Can also be set per-profile in the [profile] section of .profile files
#                   (per-profile value overrides this global setting).

[device]
# usb_port = /dev/ttyACM0
# modifier_delay = 0

# =============================================================================
# CONFIGURATION FORMAT
# =============================================================================
#
# This config uses PROFILES - each profile defines button mappings.
#
# The [profile:default] section is required and is used:
#   - On X11: Always (no profile switching available)
#   - On Wayland: When no app-specific profile matches
#
# You can add app-specific profiles for automatic switching on Wayland.
# See examples at the end of this file.
#
# =============================================================================


# =============================================================================
# DEFAULT PROFILE
# =============================================================================
# This profile is used on X11 (always) and Wayland (when no other profile matches)
#
# Available buttons:
#   - side, top, tall, short          (main buttons)
#   - c1, c2                           (right side buttons)
#   - dpad_up, dpad_down, dpad_left, dpad_right  (d-pad)
#   - scroll_click, knob_click, dial_click       (clickable controls)
#   - tour                             (tour button)
#
# Available rotary controls:
#   - scroll_up, scroll_down           (scroll wheel)
#   - knob_cw, knob_ccw               (knob)
#   - dial_cw, dial_ccw               (dial)
#
# Action formats:
#   Single key:         KEY_A, KEY_SPACE, KEY_ENTER
#   Key combination:    KEY_LEFTCTRL+KEY_C  (Ctrl+C)
#   Multiple modifiers: KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_T
#   Mouse wheel:        REL_WHEEL:1 (up), REL_WHEEL:-1 (down)
#   Horizontal wheel:   REL_HWHEEL:1 (right), REL_HWHEEL:-1 (left)
#   No action:          none
#
# =============================================================================
# KEY REFERENCE
# =============================================================================
#
# Modifier keys:
#   KEY_LEFTCTRL, KEY_RIGHTCTRL
#   KEY_LEFTSHIFT, KEY_RIGHTSHIFT
#   KEY_LEFTALT, KEY_RIGHTALT
#   KEY_LEFTMETA (Windows/Super key)
#
# Letter keys:
#   KEY_A through KEY_Z
#
# Number keys:
#   KEY_0 through KEY_9
#
# Function keys:
#   KEY_F1 through KEY_F12
#
# Navigation keys:
#   KEY_UP, KEY_DOWN, KEY_LEFT, KEY_RIGHT
#   KEY_HOME, KEY_END, KEY_PAGEUP, KEY_PAGEDOWN
#
# Special keys:
#   KEY_SPACE, KEY_ENTER, KEY_TAB, KEY_ESC
#   KEY_BACKSPACE, KEY_DELETE, KEY_INSERT
#   KEY_CONTEXT_MENU (right-click menu)
#
# Symbol keys:
#   KEY_MINUS, KEY_EQUAL, KEY_LEFTBRACE, KEY_RIGHTBRACE
#   KEY_SEMICOLON, KEY_APOSTROPHE, KEY_GRAVE, KEY_BACKSLASH
#   KEY_COMMA, KEY_DOT, KEY_SLASH, KEY_PERIOD
#
# Zoom/Application keys:
#   KEY_ZOOMRESET, KEY_ZOOMIN, KEY_ZOOMOUT
#   KEY_VOLUMEUP, KEY_VOLUMEDOWN, KEY_MUTE
#
# Mouse scroll events:
#   REL_WHEEL:1      (scroll up)
#   REL_WHEEL:-1     (scroll down)
#   REL_HWHEEL:1     (scroll right)
#   REL_HWHEEL:-1    (scroll left)
#
# Mouse button events:
#   BTN_LEFT         (left click)
#   BTN_RIGHT        (right click)
#   BTN_MIDDLE       (middle click)
#
# =============================================================================
# MODIFIER BUTTONS (NEW FEATURE)
# =============================================================================
#
# Physical buttons can act as modifiers (like Ctrl/Alt/Shift on a keyboard)
#
# To declare a button as a modifier:
#   tall = modifier
#
# Optional base action (executed when pressed alone):
#   tall.base_action = KEY_LEFTALT
#   tall.base_action.comment = Acts as Alt when pressed alone
#
# Modifier combinations (executed when modifier is held + another control):
#   tall.c1 = KEY_LEFTCTRL+KEY_Z        # Undo when tall+c1
#   tall.c2 = KEY_LEFTCTRL+KEY_Y        # Redo when tall+c2
#   tall.scroll_up = KEY_LEFTCTRL+KEY_EQUAL    # Zoom in when tall+scroll up
#
# Add comments to any mapping using the .comment suffix:
#   tall.comment = This is my undo/redo modifier button
#   tall.c1.comment = Undo action with explanation
#   c1.comment = Regular notes for non-modifier buttons work too!
#
# Multiline comments use \n escape sequences:
#   c2.comment = This is line 1\nThis is line 2\nThis is line 3
#
# Notes:
#   - Only PHYSICAL buttons can be modifiers (not scroll_up, knob_cw, etc.)
#   - Valid modifiers: side, top, tall, short, c1, c2, tour, dpad buttons, clicks
#   - Single modifier support (no tall+short+c1 combos)
#   - Modifier state is cleared on disconnect, profile switch, or config reload
#   - When a button is a modifier, it no longer has a regular action
#     (unless you define a base_action)
#
# Example modifier configuration (uncomment to use):
#
#   tall = modifier
#   tall.base_action = KEY_LEFTALT
#   tall.base_action.comment = Acts as Alt key when pressed alone
#   tall.comment = My primary modifier for undo/redo/zoom operations
#   tall.c1 = KEY_LEFTCTRL+KEY_Z
#   tall.c1.comment = Undo
#   tall.c2 = KEY_LEFTCTRL+KEY_Y
#   tall.c2.comment = Redo
#   tall.scroll_up = KEY_LEFTCTRL+KEY_EQUAL
#   tall.scroll_up.comment = Zoom in
#   tall.scroll_down = KEY_LEFTCTRL+KEY_MINUS
#   tall.scroll_down.comment = Zoom out
#
# =============================================================================

# =============================================================================
# BUTTON OPTIONS
# =============================================================================
#
# Double-press action:
#   Assign a different action when a button is pressed twice quickly.
#   button.double = ACTION
#
#   Example:
#     side.double = KEY_B           # Side double-press = B key
#     top.double = KEY_LEFTCTRL+KEY_S   # Top double-press = Ctrl+S
#
# On-release mode:
#   Fire action when button is released (as a tap) instead of when pressed.
#   Useful for buttons with combos or double-press to improve reliability.
#   button.on_release = true
#
#   Example:
#     top.on_release = true         # Top fires on release
#
#   Notes:
#   - Only applies to physical buttons (not rotary controls)
#   - Action fires as a tap (press+release together) on button release
#   - Helps prevent combo misfires by deferring action until release
#   - Works well with double-press: release starts the detection window
#
# =============================================================================

# =============================================================================
# TUXBOX GUI META-CONFIGURATION PROFILE
# =============================================================================
# This profile allows the TourBox to control its own configuration GUI!
# When you press a physical control, it automatically selects that control
# in the Controls Configuration table for editing.
#
# This creates an intuitive workflow: touch the control you want to configure,
# and it immediately becomes selected in the GUI.
# =============================================================================

[profile:TuxBox GUI]
window_class = tuxbox-gui
app_id = tuxbox-gui

# Main buttons - mapped to Ctrl+Alt+Shift+F1-F4
side = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F1
top = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F2
tall = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F3
short = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F4

# Right side buttons - mapped to Ctrl+Alt+Shift+F5-F6
c1 = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F5
c2 = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F6

# Tour button - mapped to Ctrl+Alt+Shift+F7
tour = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F7

# D-Pad - mapped to Ctrl+Alt+Shift+F8-F11
dpad_up = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F8
dpad_down = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F9
dpad_left = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F10
dpad_right = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F11

# Scroll - F12 uses Ctrl+Alt+Shift, rest use Ctrl+Alt
scroll_up = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_F12
scroll_down = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_1
scroll_click = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_2

# Knob - mapped to Ctrl+Alt+Super+F3-F5
knob_cw = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_3
knob_ccw = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_4
knob_click = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_5

# Dial - mapped to Ctrl+Alt+Super+F6-F8
dial_cw = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_6
dial_ccw = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_7
dial_click = KEY_LEFTCTRL+KEY_LEFTALT+KEY_LEFTSHIFT+KEY_8

[profile:default]
# Main buttons
side = KEY_LEFTMETA
top = KEY_LEFTSHIFT
tall = KEY_LEFTALT
short = KEY_SPACE

# Right side buttons
c1 = KEY_LEFTCTRL+KEY_Y
c2 = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_Y

# D-Pad
dpad_up = KEY_E
dpad_down = KEY_S
dpad_left = KEY_J
dpad_right = KEY_B

# Clickable controls
scroll_click = KEY_ZOOMRESET
knob_click = none
dial_click = KEY_CONTEXT_MENU
tour = KEY_INSERT

# Rotary controls
scroll_up = REL_WHEEL:1
scroll_down = REL_WHEEL:-1
knob_cw = KEY_LEFTCTRL+KEY_EQUAL       # Zoom in
knob_ccw = KEY_LEFTCTRL+KEY_MINUS      # Zoom out
dial_cw = REL_HWHEEL:1
dial_ccw = REL_HWHEEL:-1

# =============================================================================
# APPLICATION-SPECIFIC PROFILES (Wayland only)
# =============================================================================
#
# On Wayland, you can add profiles that automatically switch when you focus
# different applications.
#
# Profile format:
#   [profile:name]
#   window_class = ApplicationClass   (exact match, case-insensitive)
#   window_title = Window Title        (substring match, case-insensitive)
#   app_id = app.id                    (exact match, case-insensitive)
#
#   # Then define button mappings (same format as default profile)
#   side = KEY_A
#   top = KEY_B
#   ...
#
# To find window_class/app_id for your apps:
#   ./venv/bin/python -m tuxbox.window_monitor
#   (Focus different windows and note the class/app_id values)
#
# Examples below - uncomment and customize!
# =============================================================================

# VSCode profile
[profile:VSCode]
app_id = Code
window_class = Code
side = KEY_LEFTCTRL+KEY_SPACE          # Code completion
top = KEY_LEFTCTRL+KEY_SLASH           # Toggle comment
tall = KEY_LEFTALT+KEY_ENTER           # Quick fix
short = KEY_F2                         # Rename
c1 = KEY_LEFTCTRL+KEY_Z                # Undo
c2 = KEY_LEFTCTRL+KEY_Y                # Redo
dpad_up = KEY_LEFTALT+KEY_UP           # Move line up
dpad_down = KEY_LEFTALT+KEY_DOWN       # Move line down
dpad_left = KEY_LEFTCTRL+KEY_PAGEUP    # Previous tab
dpad_right = KEY_LEFTCTRL+KEY_PAGEDOWN # Next tab
scroll_click = KEY_LEFTCTRL+KEY_B      # Toggle sidebar
dial_click = KEY_F12                   # Go to definition
tour = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_P  # Command palette
scroll_up = REL_WHEEL:1
scroll_down = REL_WHEEL:-1
knob_cw = KEY_LEFTCTRL+KEY_EQUAL       # Zoom in
knob_ccw = KEY_LEFTCTRL+KEY_MINUS      # Zoom out
dial_cw = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_RIGHTBRACE  # Next change
dial_ccw = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_LEFTBRACE  # Previous change

# Firefox/Browser profile
[profile:Firefox]
app_id = firefox-esr
window_class = firefox-esr
side = KEY_LEFTALT+KEY_LEFT            # Back
top = KEY_LEFTALT+KEY_RIGHT            # Forward
tall = KEY_LEFTCTRL+KEY_T              # New tab
short = KEY_F5                         # Refresh
c1 = KEY_LEFTCTRL+KEY_W                # Close tab
c2 = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_T  # Reopen closed tab
dpad_left = KEY_LEFTCTRL+KEY_PAGEUP    # Previous tab
dpad_right = KEY_LEFTCTRL+KEY_PAGEDOWN # Next tab
dpad_up = KEY_HOME                     # Scroll to top
dpad_down = KEY_END                    # Scroll to bottom
scroll_click = KEY_LEFTCTRL+KEY_F      # Find
dial_click = KEY_LEFTCTRL+KEY_D        # Bookmark
tour = KEY_LEFTCTRL+KEY_L              # Focus address bar
scroll_up = REL_WHEEL:1
scroll_down = REL_WHEEL:-1
knob_cw = KEY_LEFTCTRL+KEY_EQUAL       # Zoom in
knob_ccw = KEY_LEFTCTRL+KEY_MINUS      # Zoom out
dial_cw = KEY_SPACE                    # Page down
dial_ccw = KEY_LEFTSHIFT+KEY_SPACE     # Page up

# GIMP profile
[profile:Gimp]
app_id = gimp
window_class = gimp
side = KEY_LEFTCTRL+KEY_Z              # Undo
top = KEY_LEFTCTRL+KEY_Y               # Redo
tall = KEY_B                           # Brush tool
short = KEY_E                          # Eraser
c1 = KEY_LEFTBRACE                     # Decrease brush size
c2 = KEY_RIGHTBRACE                    # Increase brush size
dpad_up = KEY_LEFTSHIFT                # Hold for line mode
dpad_down = KEY_LEFTALT                # Pick color
dpad_left = KEY_X                      # Swap colors
dpad_right = KEY_D                     # Reset colors
scroll_click = KEY_F                   # Fit window
dial_click = KEY_TAB                   # Toggle docks
tour = KEY_SLASH                       # Search actions
scroll_up = KEY_LEFTSHIFT+KEY_EQUAL    # Zoom in
scroll_down = KEY_MINUS                # Zoom out
knob_cw = KEY_RIGHTBRACE               # Increase brush
knob_ccw = KEY_LEFTBRACE               # Decrease brush
dial_cw = KEY_PERIOD                   # Next layer
dial_ccw = KEY_COMMA                   # Previous layer

# KRITA profile
[profile:Krita]
app_id = krita
window_class = krita
side = KEY_LEFTCTRL                             # Ctrl
top = KEY_LEFTSHIFT                             # Shift
tall = KEY_B                                    # Brush tool
short = KEY_SPACE                               # Space
c1 = KEY_LEFTCTRL+KEY_Z                         # Undo
c2 = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_Z           # Redo
dpad_up = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_R      # Freehand selection tool
dpad_down = KEY_LEFTCTRL+KEY_LEFTSHIFT+KEY_A    # Deselect
dpad_left = KEY_T                               # Move tool
dpad_right = KEY_LEFTCTRL+KEY_T                 # Transform tool
tour = KEY_E                                    # Eraser
scroll_up = KEY_LEFTCTRL+KEY_EQUAL              # Zoom in
scroll_down = KEY_LEFTCTRL+KEY_MINUS            # Zoom out
scroll_click = KEY_2                            # Reset Zoom
knob_cw = KEY_RIGHTBRACE                        # Increase brush size
knob_ccw = KEY_LEFTBRACE                        # Decrease brush size
dial_cw = KEY_LEFTCTRL+KEY_RIGHTBRACE           # Rotate right
dial_ccw = KEY_LEFTCTRL+KEY_LEFTBRACE           # Rotate left
dial_click = KEY_5                              # Reset Rotate
